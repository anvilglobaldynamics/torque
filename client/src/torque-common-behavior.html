<link rel="import" href="../bower_components/atomicdb/atomicdb.html">
<script>
  if (!window.TorqueCommonBehavior) {
    /* @polymerMixin */
    TorqueCommonBehavior = (SuperClass) => class extends SuperClass {

      constructor(...args) {
        super(...args);
      }

      static get properties() {
        return {
          isReady: {
            type: Boolean,
            value: false,
            observer: 'isReadyChanged'
          }
        }
      }

      isReadyChanged() {
        if (this.isReady) {
          this.app.topSpinnerEnabled = true;
        } else {
          this.app.topSpinnerEnabled = false;
        }
      }

      onNavigateOut() {
        super.onNavigateOut();
        this.isReady = false;
      }

      $if(condition, thenValue, elseValue) {
        if (condition) return thenValue;
        return elseValue;
      }

      delay(ms, fn, ...args) {
        window.setTimeout(fn, ms, ...args);
      }

      onApiError(error, form) {
        if ((error.code === "VALIDATION_ERROR") && form) {
          let missingError = null;
          let { details: errorList } = error;
          for (let error of errorList) {
            let { path, message } = error;
            let key = `.${form}--${path}`;
            let el = this.elem(key);
            if (!el) {
              missingError = error;
              continue;
            }
            el.autoValidate = true;
            el.invalid = true;
            el.errorMessage = message;
          }
          if (missingError) {
            return this.app.showModalDialog("Sorry!", missingError.message);
          }
        } else {
          return this.app.showModalDialog("Sorry!", error.message);
        }
      }

    }
  }

</script>