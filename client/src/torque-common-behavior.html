<script>
  /* 
  FIXME: This behavior got a bit too much multi purpose. It is being used by both pages and
  embedded elements. But all the properties and methods are not compatible with both.
  Better to split it into two behaviors - 
  TorqueCommonBehavior = Something not page specific
  TorquePageBehavior = Page Specific
  */
  (function () {
    if (window.TorqueCommonBehavior) return;
    /* @polymerMixin */
    TorqueCommonBehavior = (SuperClass) => class extends SuperClass {

      constructor(...args) {
        super(...args);
      }

      // PATCH START
      // NOTE: This is a patch for FxElement#resetProperties()
      // In time, it will be moved to polymer-fx.
      resetProperties(...propertyList) {
        for (let name of propertyList) {
          let type = this.constructor.properties[name].type;
          let val = this.constructor.properties[name].value;
          if (typeof (val) === 'function') val = val();
          if (type === Array) {
            this.set(name, []);
          } else {
            this.set(name, null);
          }
          this.set(name, val);
        }
      }
      // PATCH END

      genericEmbeddedFormSubmitionKeypress(e) {
        if (e.which !== 13) return;
        if (e.target.nodeName !== 'PAPER-INPUT') return;
        let el = e.target;
        while (el && el.parentNode) {
          el = el.parentNode;
        }
        el = el.host;
        while (el && el.nodeName !== 'IRON-FORM') {
          el = el.parentNode;
        }
        if (!el) return;
        el.querySelectorAll(`.${el.id}--submit`).forEach(submitEl => {
          if (submitEl) {
            if (submitEl.className.indexOf("hidden") > -1) return;
            submitEl.click();
          }
        });
      }

      $join(list, by) {
        return list.join(by);
      }

      $if(condition, thenValue, elseValue) {
        if (condition) return thenValue;
        return elseValue;
      }

      delay(ms, fn, ...args) {
        window.setTimeout(fn, ms, ...args);
      }

      $json(obj) {
        return (JSON.stringify(obj));
      }

      $round(number) {
        if (!number) {
          number = 0;
        }
        return (Math.round(number * 100) / 100);
      }

      /** $mkDate()
       * Converts a date to a user friendly string
       * See http://arshaw.com/xdate/ for formatting instruction
       * @param {Date|timestamp} date
       * @param {string} format 
       * @returns 
       */
      $mkDate(date, format = 'MMM d, yyyy') {
        return (new XDate(date)).toString(format);
      }

      $inc(number) {
        return number + 1;
      }

    }
  })();

</script>