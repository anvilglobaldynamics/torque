<script>

  (function () {
    if (window.TorqueCommonBehavior) return;
    /* @polymerMixin */
    TorqueCommonBehavior = (SuperClass) => class extends SuperClass {

      constructor(...args) {
        super(...args);
      }

      genericEmbeddedFormSubmitionKeypress(e) {
        if (e.which !== 13) return;
        if (e.target.nodeName !== 'PAPER-INPUT') return;
        let el = e.target;
        while (el && el.parentNode) {
          el = el.parentNode;
        }
        el = el.host;
        while (el && el.nodeName !== 'IRON-FORM') {
          el = el.parentNode;
        }
        if (!el) return;
        el.querySelectorAll(`.${el.id}--submit`).forEach(submitEl => {
          if (submitEl) {
            if (submitEl.className.indexOf("hidden") > -1) return;
            submitEl.click();
          }
        });
      }

      $join(list, by) {
        return list.join(by);
      }

      $if(condition, thenValue, elseValue) {
        if (condition) return thenValue;
        return elseValue;
      }

      delay(ms, fn, ...args) {
        window.setTimeout(fn, ms, ...args);
      }

      $json(obj) {
        return (JSON.stringify(obj));
      }

      $round(number) {
        if (!number) {
          number = 0;
        }
        return (Math.round(number * 100) / 100);
      }

      /** $mkDate()
       * Converts a date to a user friendly string
       * See http://arshaw.com/xdate/ for formatting instruction
       * @param {Date|timestamp} date
       * @param {string} format 
       * @returns 
       */
      $mkDate(date, format = 'MMM d, yyyy') {
        try {
          return (new XDate(date)).toString(format);
        } catch (ex) {
          console.error(ex);
          return 'INVALID DATE';
        }
      }

      $inc(number) {
        return number + 1;
      }

      enforceMinMaxOnPaperInput(e) {
        try {
          let el = e.target;

          if (typeof (el.value) === 'undefined' || el.value === '') {
            el.value = String(el.min);
          }

          if (typeof (el.max) !== 'undefined') {
            if (parseFloat(el.value) > parseFloat(el.max)) {
              el.value = String(el.max);
            }
          }

          if (typeof (el.min) !== 'undefined') {
            if (parseFloat(el.value) < parseFloat(el.min)) {
              el.value = String(el.min);
            }
          }

        } catch (err) {
          console.error(err);
        }
      }

    }
  })();

</script>